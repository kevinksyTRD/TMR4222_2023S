<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Pump Control | TMR4222 Marine Machinery - Viscous Flow in Pipes</title>
    <meta name="generator" content="VuePress 1.9.8">
    <script type="text/javascript" src="https://polyfill.io/v3/polyfill.js?features=es6"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-mml-chtml.js"></script>
    <meta name="description" content="Documentation for TMR4222 Viscous Flow in Pipe">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/TMR4222_2023S/assets/css/0.styles.4543153c.css" as="style"><link rel="preload" href="/TMR4222_2023S/assets/js/app.4abb8553.js" as="script"><link rel="preload" href="/TMR4222_2023S/assets/js/2.2891b1df.js" as="script"><link rel="preload" href="/TMR4222_2023S/assets/js/5.c3e09589.js" as="script"><link rel="prefetch" href="/TMR4222_2023S/assets/js/10.2f61165d.js"><link rel="prefetch" href="/TMR4222_2023S/assets/js/11.2d18e7c2.js"><link rel="prefetch" href="/TMR4222_2023S/assets/js/12.3587cb85.js"><link rel="prefetch" href="/TMR4222_2023S/assets/js/13.f4be4253.js"><link rel="prefetch" href="/TMR4222_2023S/assets/js/14.25aae0a8.js"><link rel="prefetch" href="/TMR4222_2023S/assets/js/15.9724357a.js"><link rel="prefetch" href="/TMR4222_2023S/assets/js/16.b87e2b3e.js"><link rel="prefetch" href="/TMR4222_2023S/assets/js/17.ce1966c7.js"><link rel="prefetch" href="/TMR4222_2023S/assets/js/3.2051a86c.js"><link rel="prefetch" href="/TMR4222_2023S/assets/js/4.56bc5be8.js"><link rel="prefetch" href="/TMR4222_2023S/assets/js/6.ff7d345b.js"><link rel="prefetch" href="/TMR4222_2023S/assets/js/7.703bd4b0.js"><link rel="prefetch" href="/TMR4222_2023S/assets/js/8.6b2ef9ff.js"><link rel="prefetch" href="/TMR4222_2023S/assets/js/9.8906a95d.js">
    <link rel="stylesheet" href="/TMR4222_2023S/assets/css/0.styles.4543153c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/TMR4222_2023S/" class="home-link router-link-active"><!----> <span class="site-name">TMR4222 Marine Machinery - Viscous Flow in Pipes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/TMR4222_2023S/" aria-current="page" class="sidebar-link">Introduction</a></li><li><a href="/TMR4222_2023S/python-with-anaconda/" class="sidebar-link">Python with Anaconda</a></li><li><a href="/TMR4222_2023S/numerical-method-python/" class="sidebar-link">Numerical method in Python</a></li><li><a href="/TMR4222_2023S/pipe-friction/" class="sidebar-link">Pipe Friction</a></li><li><a href="/TMR4222_2023S/pipe-network-analysis/" class="sidebar-link">Pipe Network Analysis</a></li><li><a href="/TMR4222_2023S/pump-performance/" class="sidebar-link">Pump Performance</a></li><li><a href="/TMR4222_2023S/pump-control/" aria-current="page" class="active sidebar-link">Pump Control</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TMR4222_2023S/pump-control/#_1-pump-operating-point" class="sidebar-link">1. Pump operating point</a></li><li class="sidebar-sub-header"><a href="/TMR4222_2023S/pump-control/#_2-flow-control-by-valve" class="sidebar-link">2. Flow control by valve</a></li><li class="sidebar-sub-header"><a href="/TMR4222_2023S/pump-control/#_3-flow-control-by-bypass" class="sidebar-link">3. Flow control by bypass</a></li><li class="sidebar-sub-header"><a href="/TMR4222_2023S/pump-control/#_4-flow-control-by-speed-control" class="sidebar-link">4 Flow control by speed control</a></li></ul></li><li><a href="/TMR4222_2023S/positive-displacement-pump/" class="sidebar-link">Positive Displacement Pump</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="pump-control"><a href="#pump-control" class="header-anchor">#</a> Pump Control</h1> <p>First, we will import the necessary packages to solve the problems.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> fluids <span class="token keyword">import</span> friction<span class="token punctuation">,</span> core<span class="token punctuation">,</span> fittings
<span class="token keyword">from</span> fluids<span class="token punctuation">.</span>piping <span class="token keyword">import</span> nearest_pipe
<span class="token keyword">from</span> pyfluids <span class="token keyword">import</span> Fluid<span class="token punctuation">,</span> FluidsList<span class="token punctuation">,</span> Input
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> scipy<span class="token punctuation">.</span>optimize <span class="token keyword">import</span> root_scalar
<span class="token keyword">from</span> plotly<span class="token punctuation">.</span>subplots <span class="token keyword">import</span> make_subplots
</code></pre></div><h2 id="_1-pump-operating-point"><a href="#_1-pump-operating-point" class="header-anchor">#</a> 1. Pump operating point</h2> <p>Pump H-Q curve and \(\eta\)-Q is fitted to the following polynomial.</p> <p>$$
H = 150 - 20Q^2
$$
$$
\eta = -0.420Q^2 + 1.06Q + 0.188
$$</p> <p>The maximum flow of the pump is 1.5 m3/s. The pump is unstable over this flow.</p> <p>The pump is operating at 1170 RPM and pump water at 20<sup>o</sup>C from one reservoir to another 35m higher through 450m steel pipe of nominal diameter 400mm with schedule 40. What is the operating point of the pump? What is the power consumption of the pump?</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># Let's plot the pump curve first</span>

<span class="token keyword">def</span> <span class="token function">get_pump_head_m</span><span class="token punctuation">(</span>vol_flow_m3_per_s<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">float</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;Returns the pump head&quot;&quot;&quot;</span>
    <span class="token keyword">return</span> <span class="token number">150</span> <span class="token operator">-</span> <span class="token number">20.0</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>power<span class="token punctuation">(</span>vol_flow_m3_per_s<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">get_pump_efficiency</span><span class="token punctuation">(</span>vol_flow_m3_per_s<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">float</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;Returns the pump efficiency&quot;&quot;&quot;</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">0.42</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>power<span class="token punctuation">(</span>vol_flow_m3_per_s<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1.06</span> <span class="token operator">*</span> vol_flow_m3_per_s <span class="token operator">+</span> <span class="token number">0.188</span>

vol_flow_m3_per_s_array <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
pump_head_m_array <span class="token operator">=</span> get_pump_head_m<span class="token punctuation">(</span>vol_flow_m3_per_s_array<span class="token punctuation">)</span>
pump_efficiency_array <span class="token operator">=</span> get_pump_efficiency<span class="token punctuation">(</span>vol_flow_m3_per_s_array<span class="token punctuation">)</span>
fig <span class="token operator">=</span> make_subplots<span class="token punctuation">(</span>specs<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token builtin">dict</span><span class="token punctuation">(</span>secondary_y<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
fig<span class="token punctuation">.</span>add_scatter<span class="token punctuation">(</span>x<span class="token operator">=</span>vol_flow_m3_per_s_array<span class="token punctuation">,</span> y<span class="token operator">=</span>pump_head_m_array<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">&quot;pump head&quot;</span><span class="token punctuation">)</span>
fig<span class="token punctuation">.</span>add_scatter<span class="token punctuation">(</span>x<span class="token operator">=</span>vol_flow_m3_per_s_array<span class="token punctuation">,</span> y<span class="token operator">=</span>pump_efficiency_array<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">&quot;pump efficiency&quot;</span><span class="token punctuation">,</span> secondary_y<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
fig<span class="token punctuation">.</span>show<span class="token punctuation">(</span>renderer<span class="token operator">=</span><span class="token string">&quot;svg&quot;</span><span class="token punctuation">)</span>

</code></pre></div><p><img src="/TMR4222_2023S/assets/img/04_Centrifugal_Pump_Control_4_0.ff4b9775.svg" alt="svg"></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># Let's get the system head loss curve</span>
fluid <span class="token operator">=</span> Fluid<span class="token punctuation">(</span>FluidsList<span class="token punctuation">.</span>Water<span class="token punctuation">)</span><span class="token punctuation">.</span>with_state<span class="token punctuation">(</span>Input<span class="token punctuation">.</span>pressure<span class="token punctuation">(</span><span class="token number">1e5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Input<span class="token punctuation">.</span>temperature<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
_<span class="token punctuation">,</span> inner_dia_m<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _ <span class="token operator">=</span> nearest_pipe<span class="token punctuation">(</span>Di<span class="token operator">=</span><span class="token number">0.4</span><span class="token punctuation">,</span> schedule<span class="token operator">=</span><span class="token string">&quot;40&quot;</span><span class="token punctuation">)</span>
roughness <span class="token operator">=</span> friction<span class="token punctuation">.</span>material_roughness<span class="token punctuation">(</span><span class="token string">&quot;clean steel pipe&quot;</span><span class="token punctuation">)</span>
pipe_section_area_m2 <span class="token operator">=</span> np<span class="token punctuation">.</span>pi <span class="token operator">*</span> inner_dia_m<span class="token operator">**</span><span class="token number">2</span> <span class="token operator">/</span> <span class="token number">4</span>
h_lift <span class="token operator">=</span> <span class="token number">35</span>

<span class="token keyword">def</span> <span class="token function">get_system_head_m</span><span class="token punctuation">(</span>vol_flow_m3_per_s<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">float</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;Returns the system head loss in meter&quot;&quot;&quot;</span>
    pressure_drop <span class="token operator">=</span> friction<span class="token punctuation">.</span>one_phase_dP<span class="token punctuation">(</span>
        m<span class="token operator">=</span>vol_flow_m3_per_s <span class="token operator">*</span> fluid<span class="token punctuation">.</span>density<span class="token punctuation">,</span>
        rho<span class="token operator">=</span>fluid<span class="token punctuation">.</span>density<span class="token punctuation">,</span>
        mu<span class="token operator">=</span>fluid<span class="token punctuation">.</span>dynamic_viscosity<span class="token punctuation">,</span>
        D<span class="token operator">=</span>inner_dia_m<span class="token punctuation">,</span>
        roughness<span class="token operator">=</span>roughness<span class="token punctuation">,</span>
        L<span class="token operator">=</span><span class="token number">450</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">return</span> pressure_drop <span class="token operator">/</span> fluid<span class="token punctuation">.</span>density <span class="token operator">/</span> <span class="token number">9.81</span> <span class="token operator">+</span> h_lift

head_system_m_array <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>
    get_system_head_m<span class="token punctuation">(</span>vol_flow<span class="token punctuation">)</span>
    <span class="token keyword">for</span> vol_flow <span class="token keyword">in</span> vol_flow_m3_per_s_array<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
fig <span class="token operator">=</span> make_subplots<span class="token punctuation">(</span><span class="token punctuation">)</span>
fig<span class="token punctuation">.</span>add_scatter<span class="token punctuation">(</span>x<span class="token operator">=</span>vol_flow_m3_per_s_array<span class="token punctuation">,</span> y<span class="token operator">=</span>pump_head_m_array<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">&quot;pump&quot;</span><span class="token punctuation">)</span>
fig<span class="token punctuation">.</span>add_scatter<span class="token punctuation">(</span>x<span class="token operator">=</span>vol_flow_m3_per_s_array<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y<span class="token operator">=</span>head_system_m_array<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">&quot;head_loss&quot;</span><span class="token punctuation">)</span>
fig<span class="token punctuation">.</span>show<span class="token punctuation">(</span>renderer<span class="token operator">=</span><span class="token string">&quot;svg&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p><img src="/TMR4222_2023S/assets/img/04_Centrifugal_Pump_Control_5_0.06ffaf7c.svg" alt="svg"></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># Find the flow exactly</span>
<span class="token keyword">def</span> <span class="token function">function_to_solve</span><span class="token punctuation">(</span>vol_flow_m3_per_s<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">float</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;Function to solve for flow&quot;&quot;&quot;</span>
    pump_head_m <span class="token operator">=</span> get_pump_head_m<span class="token punctuation">(</span>vol_flow_m3_per_s<span class="token punctuation">)</span>
    head_loss_m <span class="token operator">=</span> get_system_head_m<span class="token punctuation">(</span>vol_flow_m3_per_s<span class="token punctuation">)</span>
    <span class="token keyword">return</span> pump_head_m <span class="token operator">-</span> head_loss_m

sol <span class="token operator">=</span> root_scalar<span class="token punctuation">(</span>f<span class="token operator">=</span>function_to_solve<span class="token punctuation">,</span> x0<span class="token operator">=</span><span class="token number">1.4</span><span class="token punctuation">,</span> x1<span class="token operator">=</span><span class="token number">1.5</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> sol<span class="token punctuation">.</span>converged<span class="token punctuation">:</span>
    vol_flow_only_pipe_m3_per_s <span class="token operator">=</span> sol<span class="token punctuation">.</span>root
    pump_head_only_pipe_m <span class="token operator">=</span> get_pump_head_m<span class="token punctuation">(</span>vol_flow_only_pipe_m3_per_s<span class="token punctuation">)</span>
    efficiency <span class="token operator">=</span> get_pump_efficiency<span class="token punctuation">(</span>vol_flow_only_pipe_m3_per_s<span class="token punctuation">)</span>
    power_only_pipe_kw <span class="token operator">=</span> \
        fluid<span class="token punctuation">.</span>density <span class="token operator">*</span> <span class="token number">9.81</span> \
        <span class="token operator">*</span> vol_flow_only_pipe_m3_per_s \
        <span class="token operator">*</span> pump_head_only_pipe_m \
        <span class="token operator">/</span> efficiency \
        <span class="token operator">/</span> <span class="token number">1000</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Volume flow: </span><span class="token interpolation"><span class="token punctuation">{</span>vol_flow_only_pipe_m3_per_s<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">m3/s&quot;</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Head: </span><span class="token interpolation"><span class="token punctuation">{</span>pump_head_only_pipe_m<span class="token punctuation">:</span><span class="token format-spec">.1f</span><span class="token punctuation">}</span></span><span class="token string">m&quot;</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Efficiency: </span><span class="token interpolation"><span class="token punctuation">{</span>efficiency<span class="token punctuation">:</span><span class="token format-spec">.3f</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Power: </span><span class="token interpolation"><span class="token punctuation">{</span>power_only_pipe_kw<span class="token punctuation">:</span><span class="token format-spec">.1f</span><span class="token punctuation">}</span></span><span class="token string">kW&quot;</span></span><span class="token punctuation">)</span>
</code></pre></div><div class="language- extra-class"><pre><code>Volume flow: 1.26m3/s
Head: 118.4m
Efficiency: 0.857
Power: 1701.3kW
</code></pre></div><h2 id="_2-flow-control-by-valve"><a href="#_2-flow-control-by-valve" class="header-anchor">#</a> 2. Flow control by valve</h2> <p>We added an valve to control the flow. When we closed our valve by 50%, the k value (friction coefficient) of the valve is 8. What will be the flow with this valve position? What will be the k value for the valve to achieve 50% flow of one without the valve?</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">get_total_system_head_throttling_m</span><span class="token punctuation">(</span>vol_flow_m3_per_s<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">,</span> k_value<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">float</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;Return the total head loss when the valve is throttled&quot;&quot;&quot;</span>
    head_loss_pipe_m <span class="token operator">=</span> get_system_head_m<span class="token punctuation">(</span>vol_flow_m3_per_s<span class="token punctuation">)</span>
    head_loss_valve <span class="token operator">=</span> core<span class="token punctuation">.</span>head_from_K<span class="token punctuation">(</span>
        K<span class="token operator">=</span>k_value<span class="token punctuation">,</span> V<span class="token operator">=</span>vol_flow_m3_per_s <span class="token operator">/</span> pipe_section_area_m2<span class="token punctuation">,</span> g<span class="token operator">=</span><span class="token number">9.81</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">return</span> head_loss_pipe_m <span class="token operator">+</span> head_loss_valve

system_head_with_valve_m_array <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>
    get_total_system_head_throttling_m<span class="token punctuation">(</span>vol_flow<span class="token punctuation">,</span> k_value<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> vol_flow <span class="token keyword">in</span> vol_flow_m3_per_s_array<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
fig <span class="token operator">=</span> make_subplots<span class="token punctuation">(</span><span class="token punctuation">)</span>
fig<span class="token punctuation">.</span>add_scatter<span class="token punctuation">(</span>x<span class="token operator">=</span>vol_flow_m3_per_s_array<span class="token punctuation">,</span> y<span class="token operator">=</span>pump_head_m_array<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">&quot;pump head&quot;</span><span class="token punctuation">)</span>
fig<span class="token punctuation">.</span>add_scatter<span class="token punctuation">(</span>x<span class="token operator">=</span>vol_flow_m3_per_s_array<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y<span class="token operator">=</span>system_head_with_valve_m_array<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">&quot;head loss&quot;</span><span class="token punctuation">)</span>
fig<span class="token punctuation">.</span>show<span class="token punctuation">(</span>renderer<span class="token operator">=</span><span class="token string">&quot;svg&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p><img src="/TMR4222_2023S/assets/img/04_Centrifugal_Pump_Control_8_0.8df7a7b3.svg" alt="svg"></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># Find the flow exactly</span>
<span class="token keyword">def</span> <span class="token function">function_to_solve</span><span class="token punctuation">(</span>vol_flow_m3_per_s<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">float</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;Function to solve for flow&quot;&quot;&quot;</span>
    pump_head_m <span class="token operator">=</span> get_pump_head_m<span class="token punctuation">(</span>vol_flow_m3_per_s<span class="token punctuation">)</span>
    head_loss_m <span class="token operator">=</span> get_total_system_head_throttling_m<span class="token punctuation">(</span>
        vol_flow_m3_per_s<span class="token punctuation">,</span> k_value<span class="token operator">=</span><span class="token number">8</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">return</span> pump_head_m <span class="token operator">-</span> head_loss_m

sol <span class="token operator">=</span> root_scalar<span class="token punctuation">(</span>f<span class="token operator">=</span>function_to_solve<span class="token punctuation">,</span> x0<span class="token operator">=</span><span class="token number">1.4</span><span class="token punctuation">,</span> x1<span class="token operator">=</span><span class="token number">1.3</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> sol<span class="token punctuation">.</span>converged<span class="token punctuation">:</span>
    vol_flow_throttling_m3_per_s <span class="token operator">=</span> sol<span class="token punctuation">.</span>root
    pump_head_throttling_m <span class="token operator">=</span> get_pump_head_m<span class="token punctuation">(</span>vol_flow_throttling_m3_per_s<span class="token punctuation">)</span>
    efficiency <span class="token operator">=</span> get_pump_efficiency<span class="token punctuation">(</span>vol_flow_throttling_m3_per_s<span class="token punctuation">)</span>
    power_throttling_kw <span class="token operator">=</span> \
        fluid<span class="token punctuation">.</span>density <span class="token operator">*</span> <span class="token number">9.81</span> \
        <span class="token operator">*</span> vol_flow_throttling_m3_per_s \
        <span class="token operator">*</span> pump_head_throttling_m \
        <span class="token operator">/</span> efficiency \
        <span class="token operator">/</span> <span class="token number">1000</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Volume flow: </span><span class="token interpolation"><span class="token punctuation">{</span>vol_flow_throttling_m3_per_s<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">m3/s&quot;</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Head: </span><span class="token interpolation"><span class="token punctuation">{</span>pump_head_throttling_m<span class="token punctuation">:</span><span class="token format-spec">.1f</span><span class="token punctuation">}</span></span><span class="token string">m&quot;</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Efficiency: </span><span class="token interpolation"><span class="token punctuation">{</span>efficiency<span class="token punctuation">:</span><span class="token format-spec">.3f</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Power: </span><span class="token interpolation"><span class="token punctuation">{</span>power_throttling_kw<span class="token punctuation">:</span><span class="token format-spec">.1f</span><span class="token punctuation">}</span></span><span class="token string">kW&quot;</span></span><span class="token punctuation">)</span>
</code></pre></div><div class="language- extra-class"><pre><code>Volume flow: 1.12m3/s
Head: 125.1m
Efficiency: 0.848
Power: 1612.3kW
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># Find the k-value for reducing the flow by 50%</span>
vol_flow_throttling_by_50_per_m3_per_s <span class="token operator">=</span> <span class="token number">0.5</span> <span class="token operator">*</span> vol_flow_only_pipe_m3_per_s
pump_head_throttling_by_50_per_m <span class="token operator">=</span> get_pump_head_m<span class="token punctuation">(</span>vol_flow_throttling_by_50_per_m3_per_s<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">function_to_solve</span><span class="token punctuation">(</span>k_value<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">float</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;Function to solve for k value&quot;&quot;&quot;</span>
    head_loss_m <span class="token operator">=</span> get_total_system_head_throttling_m<span class="token punctuation">(</span>
        vol_flow_throttling_by_50_per_m3_per_s<span class="token punctuation">,</span> k_value<span class="token operator">=</span>k_value
    <span class="token punctuation">)</span>
    <span class="token keyword">return</span> pump_head_throttling_by_50_per_m <span class="token operator">-</span> head_loss_m

sol <span class="token operator">=</span> root_scalar<span class="token punctuation">(</span>f<span class="token operator">=</span>function_to_solve<span class="token punctuation">,</span> x0<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span> x1<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> sol<span class="token punctuation">.</span>converged<span class="token punctuation">:</span>
    k_value <span class="token operator">=</span> sol<span class="token punctuation">.</span>root
    efficiency <span class="token operator">=</span> get_pump_efficiency<span class="token punctuation">(</span>vol_flow_throttling_by_50_per_m3_per_s<span class="token punctuation">)</span>
    power_throttling_by_50_perc_kw <span class="token operator">=</span> \
        fluid<span class="token punctuation">.</span>density <span class="token operator">*</span> <span class="token number">9.81</span> \
        <span class="token operator">*</span> vol_flow_throttling_by_50_per_m3_per_s \
        <span class="token operator">*</span> pump_head_throttling_by_50_per_m \
        <span class="token operator">/</span> efficiency \
        <span class="token operator">/</span> <span class="token number">1000</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Volume flow: </span><span class="token interpolation"><span class="token punctuation">{</span>vol_flow_throttling_by_50_per_m3_per_s<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">m3/s&quot;</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;k value: </span><span class="token interpolation"><span class="token punctuation">{</span>k_value<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Head: </span><span class="token interpolation"><span class="token punctuation">{</span>pump_head_throttling_by_50_per_m<span class="token punctuation">:</span><span class="token format-spec">.1f</span><span class="token punctuation">}</span></span><span class="token string">m&quot;</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Efficiency: </span><span class="token interpolation"><span class="token punctuation">{</span>efficiency<span class="token punctuation">:</span><span class="token format-spec">.3f</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Power: </span><span class="token interpolation"><span class="token punctuation">{</span>power_throttling_by_50_perc_kw<span class="token punctuation">:</span><span class="token format-spec">.1f</span><span class="token punctuation">}</span></span><span class="token string">kW&quot;</span></span><span class="token punctuation">)</span>
</code></pre></div><div class="language- extra-class"><pre><code>Volume flow: 0.63m3/s
k value: 88.89
Head: 142.1m
Efficiency: 0.688
Power: 1270.8kW
</code></pre></div><h2 id="_3-flow-control-by-bypass"><a href="#_3-flow-control-by-bypass" class="header-anchor">#</a> 3. Flow control by bypass</h2> <p>As having the valve is not very efficient way to control the flow, we decided to put the bypass line with a throttling valve after the pump that returns the flow back to the reservoir. Is it possible to achieve 50% of the flow? If not, what will be the minimum flow that is possible with the pump curve given?</p> <p>============== Answer ==============</p> <p>When the flow to the destination reservoir is reduced by 50%, the system head is dropped accordingly.</p> <div class="language-python extra-class"><pre class="language-python"><code>system_head_50_per <span class="token operator">=</span> get_system_head_m<span class="token punctuation">(</span><span class="token number">0.5</span> <span class="token operator">*</span> vol_flow_only_pipe_m3_per_s<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;The system head at 50% flow: </span><span class="token interpolation"><span class="token punctuation">{</span>system_head_50_per<span class="token punctuation">:</span><span class="token format-spec">.1f</span><span class="token punctuation">}</span></span><span class="token string">m&quot;</span></span><span class="token punctuation">)</span>
</code></pre></div><div class="language- extra-class"><pre><code>The system head at 50% flow: 55.9m
</code></pre></div><p>This is too low head for the pump to operate. The minimum head that the pump can operate stably at this speed is 105m. With some margin, we will limit the pump to operate at minimum 100m. In practice, the system will have the throttling valve to maintain the minimum head. In our case, we will just operate the pump above this head without any throttling valve. Given that the minimum pump head is 100m, the minimum flow in the system is determined.</p> <div class="language-python extra-class"><pre class="language-python"><code>min_pump_head_m <span class="token operator">=</span> <span class="token number">100</span>
<span class="token comment"># Solve for the pump flow</span>
<span class="token keyword">def</span> <span class="token function">function_to_solve</span><span class="token punctuation">(</span>vol_flow_m3_per_s<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">float</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;Function to solve the equation for volume flow&quot;&quot;&quot;</span>
    <span class="token keyword">return</span> min_pump_head_m <span class="token operator">-</span> get_pump_head_m<span class="token punctuation">(</span>vol_flow_m3_per_s<span class="token punctuation">)</span>
sol <span class="token operator">=</span> root_scalar<span class="token punctuation">(</span>f<span class="token operator">=</span>function_to_solve<span class="token punctuation">,</span> x0<span class="token operator">=</span><span class="token number">1.2</span><span class="token punctuation">,</span> x1<span class="token operator">=</span><span class="token number">1.3</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> sol<span class="token punctuation">.</span>root<span class="token punctuation">:</span>
    pump_vol_flow_m3_per_s <span class="token operator">=</span> sol<span class="token punctuation">.</span>root
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">raise</span> ValueError
<span class="token comment"># Solve for the system flow</span>
<span class="token keyword">def</span> <span class="token function">function_to_solve</span><span class="token punctuation">(</span>vol_flow_m3_per_s<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">float</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;Function to solve the equation for volume flow&quot;&quot;&quot;</span>
    <span class="token keyword">return</span> min_pump_head_m <span class="token operator">-</span> get_system_head_m<span class="token punctuation">(</span>vol_flow_m3_per_s<span class="token punctuation">)</span>
sol <span class="token operator">=</span> root_scalar<span class="token punctuation">(</span>f<span class="token operator">=</span>function_to_solve<span class="token punctuation">,</span> x0<span class="token operator">=</span><span class="token number">1.2</span><span class="token punctuation">,</span> x1<span class="token operator">=</span><span class="token number">1.3</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> sol<span class="token punctuation">.</span>root<span class="token punctuation">:</span>
    system_vol_flow_m3_per_s <span class="token operator">=</span> sol<span class="token punctuation">.</span>root
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">raise</span> ValueError
bypass_vol_flow_m3_per_s <span class="token operator">=</span> pump_vol_flow_m3_per_s <span class="token operator">-</span> system_vol_flow_m3_per_s
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Volume flow from pump: </span><span class="token interpolation"><span class="token punctuation">{</span>pump_vol_flow_m3_per_s<span class="token punctuation">:</span><span class="token format-spec">.3f</span><span class="token punctuation">}</span></span><span class="token string">m3/s&quot;</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Volume flow to destination: </span><span class="token interpolation"><span class="token punctuation">{</span>system_vol_flow_m3_per_s<span class="token punctuation">:</span><span class="token format-spec">.3f</span><span class="token punctuation">}</span></span><span class="token string">m3/s&quot;</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Bypass flow: </span><span class="token interpolation"><span class="token punctuation">{</span>bypass_vol_flow_m3_per_s<span class="token punctuation">:</span><span class="token format-spec">.3f</span><span class="token punctuation">}</span></span><span class="token string"> m3/s&quot;</span></span><span class="token punctuation">)</span>

efficiency <span class="token operator">=</span> get_pump_efficiency<span class="token punctuation">(</span>pump_vol_flow_m3_per_s<span class="token punctuation">)</span>
power_bypass_kw <span class="token operator">=</span> fluid<span class="token punctuation">.</span>density <span class="token operator">*</span> <span class="token number">9.81</span> \
    <span class="token operator">*</span> min_pump_head_m \
    <span class="token operator">*</span> pump_vol_flow_m3_per_s \
    <span class="token operator">/</span> efficiency \
    <span class="token operator">/</span> <span class="token number">1000</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Efficiency: </span><span class="token interpolation"><span class="token punctuation">{</span>efficiency<span class="token punctuation">:</span><span class="token format-spec">.3f</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Power consumption: </span><span class="token interpolation"><span class="token punctuation">{</span>power_bypass_kw<span class="token punctuation">:</span><span class="token format-spec">.1f</span><span class="token punctuation">}</span></span><span class="token string">kW&quot;</span></span><span class="token punctuation">)</span>



</code></pre></div><div class="language- extra-class"><pre><code>Volume flow from pump: 1.581m3/s
Volume flow to destination: 1.110m3/s
Bypass flow: 0.471 m3/s
Efficiency: 0.814
Power consumption: 1902.1kW
</code></pre></div><h2 id="_4-flow-control-by-speed-control"><a href="#_4-flow-control-by-speed-control" class="header-anchor">#</a> 4 Flow control by speed control</h2> <p>We now see that the bypass control was not very economical either. We will now evaluate the option of speed control.
What will be the speed of the pump when the flow is 50% of the pump without any control? What is the power consumption?</p> <p>==================== Answer ======================</p> <p>The pump will follow the affinity rule since there has been no change in the geometry. The new curve for the pump with tne
new speed will be:</p> <p>\begin{aligned}
H_{N_{new}} &amp;= \left(\frac{N_{new}}{N_{1170}}\right)^2 \cdot f_{N_{1170}}\left(\frac{N_{new}}{N_{1170}} \cdot Q_{N_{New}}\right) \
&amp;=
\end{aligned}</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">get_vol_flow_from_affinity_m3_per_s</span><span class="token punctuation">(</span>vol_flow_ref_m3_per_s<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">,</span> speed_ref_rpm<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">,</span> speed_rpm<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">float</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;Returns the flow for the new speed using affinity rules&quot;&quot;&quot;</span>
    <span class="token keyword">return</span> vol_flow_ref_m3_per_s <span class="token operator">*</span> speed_rpm <span class="token operator">/</span> speed_ref_rpm

<span class="token keyword">def</span> <span class="token function">get_head_from_affinity_m</span><span class="token punctuation">(</span>head_ref_m<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">,</span> speed_ref_rpm<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">,</span> speed_rpm<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">float</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;Returns the head for the new speed using affinity rules&quot;&quot;&quot;</span>
    <span class="token keyword">return</span> head_ref_m <span class="token operator">*</span> np<span class="token punctuation">.</span>power<span class="token punctuation">(</span>speed_rpm <span class="token operator">/</span> speed_ref_rpm<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">get_pump_head_for_new_speed_m</span><span class="token punctuation">(</span>vol_flow_m3_per_s<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">,</span> speed_rpm<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">float</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;Returns the pump head for the new speed for the given flow&quot;&quot;&quot;</span>
    vol_flow_at1170_m3_per_s <span class="token operator">=</span> get_vol_flow_from_affinity_m3_per_s<span class="token punctuation">(</span>vol_flow_m3_per_s<span class="token punctuation">,</span> speed_ref_rpm<span class="token operator">=</span>speed_rpm<span class="token punctuation">,</span> speed_rpm<span class="token operator">=</span><span class="token number">1170</span><span class="token punctuation">)</span>
    head_at1170_m <span class="token operator">=</span> get_pump_head_m<span class="token punctuation">(</span>vol_flow_at1170_m3_per_s<span class="token punctuation">)</span>
    <span class="token keyword">return</span> get_head_from_affinity_m<span class="token punctuation">(</span>head_ref_m<span class="token operator">=</span>head_at1170_m<span class="token punctuation">,</span> speed_ref_rpm<span class="token operator">=</span><span class="token number">1170</span><span class="token punctuation">,</span> speed_rpm<span class="token operator">=</span>speed_rpm<span class="token punctuation">)</span>

<span class="token comment"># Let's plot when the speed is halved</span>
speed_rpm <span class="token operator">=</span> <span class="token number">1170</span> <span class="token operator">/</span> <span class="token number">2</span>
vol_flow_max_reduced_speed_m3_per_s <span class="token operator">=</span> get_vol_flow_from_affinity_m3_per_s<span class="token punctuation">(</span>
    vol_flow_ref_m3_per_s<span class="token operator">=</span>vol_flow_m3_per_s_array<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    speed_ref_rpm<span class="token operator">=</span><span class="token number">1170</span><span class="token punctuation">,</span>
    speed_rpm<span class="token operator">=</span>speed_rpm
<span class="token punctuation">)</span>
vol_flow_reduced_m3_per_s_array <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">,</span> vol_flow_max_reduced_speed_m3_per_s<span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span>
pump_head_reduced_m_array <span class="token operator">=</span> get_pump_head_for_new_speed_m<span class="token punctuation">(</span>
    vol_flow_m3_per_s<span class="token operator">=</span>vol_flow_reduced_m3_per_s_array<span class="token punctuation">,</span>
    speed_rpm<span class="token operator">=</span>speed_rpm
<span class="token punctuation">)</span>

fig <span class="token operator">=</span> make_subplots<span class="token punctuation">(</span><span class="token punctuation">)</span>
fig<span class="token punctuation">.</span>add_scatter<span class="token punctuation">(</span>x<span class="token operator">=</span>vol_flow_m3_per_s_array<span class="token punctuation">,</span> y<span class="token operator">=</span>pump_head_m_array<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">&quot;1170 rpm&quot;</span><span class="token punctuation">)</span>
fig<span class="token punctuation">.</span>add_scatter<span class="token punctuation">(</span>x<span class="token operator">=</span>vol_flow_reduced_m3_per_s_array<span class="token punctuation">,</span> y<span class="token operator">=</span>pump_head_reduced_m_array<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>speed_rpm<span class="token punctuation">}</span></span><span class="token string"> rpm&quot;</span></span><span class="token punctuation">)</span>
fig<span class="token punctuation">.</span>add_scatter<span class="token punctuation">(</span>x<span class="token operator">=</span>vol_flow_m3_per_s_array<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y<span class="token operator">=</span>head_system_m_array<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f&quot;system head loss&quot;</span></span><span class="token punctuation">)</span>
fig<span class="token punctuation">.</span>show<span class="token punctuation">(</span>renderer<span class="token operator">=</span><span class="token string">&quot;svg&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p><img src="/TMR4222_2023S/assets/img/04_Centrifugal_Pump_Control_16_0.4e185b2b.svg" alt="svg"></p> <p>To get the exact solution, we need to find the speed that satisfied the operating point of 50% flow. We get this point from the system head loss curve.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># Operating point</span>
vol_flow_reduced_m3_per_s <span class="token operator">=</span> vol_flow_only_pipe_m3_per_s <span class="token operator">*</span> <span class="token number">0.5</span>
head_required_m <span class="token operator">=</span> get_system_head_m<span class="token punctuation">(</span>vol_flow_reduced_m3_per_s<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Vol flow: </span><span class="token interpolation"><span class="token punctuation">{</span>vol_flow_reduced_m3_per_s<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">m3/s&quot;</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;head: </span><span class="token interpolation"><span class="token punctuation">{</span>head_required_m<span class="token punctuation">:</span><span class="token format-spec">.1f</span><span class="token punctuation">}</span></span><span class="token string"> m&quot;</span></span><span class="token punctuation">)</span>

<span class="token comment"># Find the pump speed that satisfies this operating condition</span>
<span class="token keyword">def</span> <span class="token function">function_to_solve</span><span class="token punctuation">(</span>speed_rpm<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">float</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;Function to solve for speed that satisfies the operating point&quot;&quot;&quot;</span>
    pump_head_m <span class="token operator">=</span> get_pump_head_for_new_speed_m<span class="token punctuation">(</span>vol_flow_m3_per_s<span class="token operator">=</span>vol_flow_reduced_m3_per_s<span class="token punctuation">,</span> speed_rpm<span class="token operator">=</span>speed_rpm<span class="token punctuation">)</span>
    <span class="token keyword">return</span> head_required_m <span class="token operator">-</span> pump_head_m

init_speed_rpm <span class="token operator">=</span> <span class="token number">0.75</span> <span class="token operator">*</span> <span class="token number">1170</span>
sol <span class="token operator">=</span> root_scalar<span class="token punctuation">(</span>f<span class="token operator">=</span>function_to_solve<span class="token punctuation">,</span> x0<span class="token operator">=</span>init_speed_rpm<span class="token punctuation">,</span> x1<span class="token operator">=</span>init_speed_rpm<span class="token operator">*</span><span class="token number">0.95</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> sol<span class="token punctuation">.</span>converged<span class="token punctuation">:</span>
    pump_speed_new_rpm <span class="token operator">=</span> sol<span class="token punctuation">.</span>root
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;The pump speed is </span><span class="token interpolation"><span class="token punctuation">{</span>pump_speed_new_rpm<span class="token punctuation">}</span></span><span class="token string"> RPM&quot;</span></span><span class="token punctuation">)</span>

vol_flow_max_reduced_speed_m3_per_s <span class="token operator">=</span> get_vol_flow_from_affinity_m3_per_s<span class="token punctuation">(</span>
    vol_flow_m3_per_s_array<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> speed_ref_rpm<span class="token operator">=</span><span class="token number">1170</span><span class="token punctuation">,</span> speed_rpm<span class="token operator">=</span>pump_speed_new_rpm
<span class="token punctuation">)</span>
vol_flow_reduced_m3_per_s_array <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">,</span> vol_flow_max_reduced_speed_m3_per_s<span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span>
pump_head_reduced_m_array <span class="token operator">=</span> get_pump_head_for_new_speed_m<span class="token punctuation">(</span>
    vol_flow_m3_per_s<span class="token operator">=</span>vol_flow_reduced_m3_per_s_array<span class="token punctuation">,</span> speed_rpm<span class="token operator">=</span>pump_speed_new_rpm
<span class="token punctuation">)</span>

fig <span class="token operator">=</span> make_subplots<span class="token punctuation">(</span><span class="token punctuation">)</span>
fig<span class="token punctuation">.</span>add_scatter<span class="token punctuation">(</span>x<span class="token operator">=</span>vol_flow_m3_per_s_array<span class="token punctuation">,</span> y<span class="token operator">=</span>pump_head_m_array<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">&quot;1170 rpm&quot;</span><span class="token punctuation">)</span>
fig<span class="token punctuation">.</span>add_scatter<span class="token punctuation">(</span>x<span class="token operator">=</span>vol_flow_reduced_m3_per_s_array<span class="token punctuation">,</span> y<span class="token operator">=</span>pump_head_reduced_m_array<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>pump_speed_new_rpm<span class="token punctuation">}</span></span><span class="token string"> rpm&quot;</span></span><span class="token punctuation">)</span>
fig<span class="token punctuation">.</span>add_scatter<span class="token punctuation">(</span>x<span class="token operator">=</span>vol_flow_m3_per_s_array<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y<span class="token operator">=</span>head_system_m_array<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f&quot;system head loss&quot;</span></span><span class="token punctuation">)</span>
fig<span class="token punctuation">.</span>show<span class="token punctuation">(</span>renderer<span class="token operator">=</span><span class="token string">&quot;svg&quot;</span><span class="token punctuation">)</span>
</code></pre></div><div class="language- extra-class"><pre><code>Vol flow: 0.63m3/s
head: 55.9 m
The pump speed is 763.198816020003 RPM
</code></pre></div><p><img src="/TMR4222_2023S/assets/img/04_Centrifugal_Pump_Control_18_1.91320793.svg" alt="svg"></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># Power consumption</span>
<span class="token comment"># For the efficiency, we can use the same efficiency as the system without control as the efficiency</span>
<span class="token comment"># could have decreased due to reduced flow but may have increased due to reduced speed.</span>
efficiency <span class="token operator">=</span> get_pump_efficiency<span class="token punctuation">(</span>vol_flow_only_pipe_m3_per_s<span class="token punctuation">)</span>

power_reduced_speed_kw <span class="token operator">=</span> fluid<span class="token punctuation">.</span>density <span class="token operator">*</span> <span class="token number">9.81</span> \
                         <span class="token operator">*</span> vol_flow_reduced_m3_per_s \
                         <span class="token operator">*</span> head_required_m \
                         <span class="token operator">/</span> efficiency \
                         <span class="token operator">/</span> <span class="token number">1000</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Power consumption: </span><span class="token interpolation"><span class="token punctuation">{</span>power_reduced_speed_kw<span class="token punctuation">:</span><span class="token format-spec">.1f</span><span class="token punctuation">}</span></span><span class="token string"> kW&quot;</span></span><span class="token punctuation">)</span>
</code></pre></div><div class="language- extra-class"><pre><code>Power consumption: 401.9 kW
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/TMR4222_2023S/pump-performance/" class="prev">
        Pump Performance
      </a></span> <span class="next"><a href="/TMR4222_2023S/positive-displacement-pump/">
        Positive Displacement Pump
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/TMR4222_2023S/assets/js/app.4abb8553.js" defer></script><script src="/TMR4222_2023S/assets/js/2.2891b1df.js" defer></script><script src="/TMR4222_2023S/assets/js/5.c3e09589.js" defer></script>
  </body>
</html>
