<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Pipe Network Analysis | TMR4222 Marine Machinery - Viscous Flow in Pipes</title>
    <meta name="generator" content="VuePress 1.9.8">
    <script type="text/javascript" src="https://polyfill.io/v3/polyfill.js?features=es6"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-mml-chtml.js"></script>
    <meta name="description" content="Documentation for TMR4222 Viscous Flow in Pipe">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/TMR4222_2023S/assets/css/0.styles.4543153c.css" as="style"><link rel="preload" href="/TMR4222_2023S/assets/js/app.4abb8553.js" as="script"><link rel="preload" href="/TMR4222_2023S/assets/js/2.2891b1df.js" as="script"><link rel="preload" href="/TMR4222_2023S/assets/js/10.2f61165d.js" as="script"><link rel="prefetch" href="/TMR4222_2023S/assets/js/11.2d18e7c2.js"><link rel="prefetch" href="/TMR4222_2023S/assets/js/12.3587cb85.js"><link rel="prefetch" href="/TMR4222_2023S/assets/js/13.f4be4253.js"><link rel="prefetch" href="/TMR4222_2023S/assets/js/14.25aae0a8.js"><link rel="prefetch" href="/TMR4222_2023S/assets/js/15.9724357a.js"><link rel="prefetch" href="/TMR4222_2023S/assets/js/16.b87e2b3e.js"><link rel="prefetch" href="/TMR4222_2023S/assets/js/17.ce1966c7.js"><link rel="prefetch" href="/TMR4222_2023S/assets/js/3.2051a86c.js"><link rel="prefetch" href="/TMR4222_2023S/assets/js/4.56bc5be8.js"><link rel="prefetch" href="/TMR4222_2023S/assets/js/5.c3e09589.js"><link rel="prefetch" href="/TMR4222_2023S/assets/js/6.ff7d345b.js"><link rel="prefetch" href="/TMR4222_2023S/assets/js/7.703bd4b0.js"><link rel="prefetch" href="/TMR4222_2023S/assets/js/8.6b2ef9ff.js"><link rel="prefetch" href="/TMR4222_2023S/assets/js/9.8906a95d.js">
    <link rel="stylesheet" href="/TMR4222_2023S/assets/css/0.styles.4543153c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/TMR4222_2023S/" class="home-link router-link-active"><!----> <span class="site-name">TMR4222 Marine Machinery - Viscous Flow in Pipes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/TMR4222_2023S/" aria-current="page" class="sidebar-link">Introduction</a></li><li><a href="/TMR4222_2023S/python-with-anaconda/" class="sidebar-link">Python with Anaconda</a></li><li><a href="/TMR4222_2023S/numerical-method-python/" class="sidebar-link">Numerical method in Python</a></li><li><a href="/TMR4222_2023S/pipe-friction/" class="sidebar-link">Pipe Friction</a></li><li><a href="/TMR4222_2023S/pipe-network-analysis/" aria-current="page" class="active sidebar-link">Pipe Network Analysis</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TMR4222_2023S/pipe-network-analysis/#equation-writing" class="sidebar-link">Equation Writing</a></li><li class="sidebar-sub-header"><a href="/TMR4222_2023S/pipe-network-analysis/#initial-values" class="sidebar-link">Initial values</a></li></ul></li><li><a href="/TMR4222_2023S/pump-performance/" class="sidebar-link">Pump Performance</a></li><li><a href="/TMR4222_2023S/pump-control/" class="sidebar-link">Pump Control</a></li><li><a href="/TMR4222_2023S/positive-displacement-pump/" class="sidebar-link">Positive Displacement Pump</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="pipe-network-analysis"><a href="#pipe-network-analysis" class="header-anchor">#</a> Pipe Network Analysis</h1> <p>Calculate the pressure at the nodes and flow in the pipes for the following pipe network in which water flows. The pipe sizes and pressure / flow boundary conditions are given as follows:</p> <p style="text-align:center;"><img src="/TMR4222_2023S/assets/img/pipe_network.198bf03d.png" width="500"></p> <table><thead><tr><th style="text-align:center;">Branch id</th> <th style="text-align:center;">Nominal Diameter</th> <th style="text-align:center;">Length</th></tr></thead> <tbody><tr><td style="text-align:center;">1</td> <td style="text-align:center;">400</td> <td style="text-align:center;">20</td></tr> <tr><td style="text-align:center;">2</td> <td style="text-align:center;">400</td> <td style="text-align:center;">25</td></tr> <tr><td style="text-align:center;">3</td> <td style="text-align:center;">500</td> <td style="text-align:center;">15</td></tr> <tr><td style="text-align:center;">4</td> <td style="text-align:center;">400</td> <td style="text-align:center;">24</td></tr> <tr><td style="text-align:center;">5</td> <td style="text-align:center;">400</td> <td style="text-align:center;">24</td></tr> <tr><td style="text-align:center;">6</td> <td style="text-align:center;">600</td> <td style="text-align:center;">30</td></tr></tbody></table> <ul><li>\(p_{b1}\) = 175000 Pa, \(p_{b2}\) = 175000 Pa, \(p_{b3}\) = 178000 Pa, \(p_{b4}\) = 178000 Pa,</li> <li>\(Q_{fb}\) = 1.5 m3/s</li> <li>Roughness of the pipe is 2e-5</li> <li>Pipe schedule is 40</li></ul> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># First import the packages</span>
<span class="token keyword">from</span> fluids <span class="token keyword">import</span> friction<span class="token punctuation">,</span> core<span class="token punctuation">,</span> fittings
<span class="token keyword">from</span> fluids<span class="token punctuation">.</span>piping <span class="token keyword">import</span> nearest_pipe
<span class="token keyword">from</span> pyfluids <span class="token keyword">import</span> Fluid<span class="token punctuation">,</span> FluidsList<span class="token punctuation">,</span> Input
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> scipy<span class="token punctuation">.</span>optimize <span class="token keyword">import</span> root_scalar<span class="token punctuation">,</span> root
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># Property</span>
water <span class="token operator">=</span> Fluid<span class="token punctuation">(</span>FluidsList<span class="token punctuation">.</span>Water<span class="token punctuation">)</span><span class="token punctuation">.</span>with_state<span class="token punctuation">(</span>Input<span class="token punctuation">.</span>pressure<span class="token punctuation">(</span><span class="token number">1e5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Input<span class="token punctuation">.</span>temperature<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># The boundary conditions</span>
q_fb1 <span class="token operator">=</span> <span class="token number">1.5</span> <span class="token comment"># m3/s</span>
mass_flow_fb1_kg_per_s <span class="token operator">=</span> q_fb1 <span class="token operator">*</span> water<span class="token punctuation">.</span>density
p_b1 <span class="token operator">=</span> <span class="token number">1.75e5</span> <span class="token comment"># Pa g</span>
p_b2 <span class="token operator">=</span> <span class="token number">1.75e5</span> <span class="token comment"># Pa g</span>
p_b3 <span class="token operator">=</span> <span class="token number">1.78e5</span> <span class="token comment"># Pa g</span>
p_b4 <span class="token operator">=</span> <span class="token number">1.78e5</span> <span class="token comment"># Pa g</span>

<span class="token comment"># Pipe dimenstions and roughness</span>
nominal_dia_list_m <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.400</span><span class="token punctuation">,</span> <span class="token number">0.400</span><span class="token punctuation">,</span> <span class="token number">0.500</span><span class="token punctuation">,</span> <span class="token number">0.400</span><span class="token punctuation">,</span> <span class="token number">0.400</span><span class="token punctuation">,</span> <span class="token number">0.600</span><span class="token punctuation">]</span>
inner_dia_list_m <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> nominal_dia <span class="token keyword">in</span> nominal_dia_list_m<span class="token punctuation">:</span>
    nps<span class="token punctuation">,</span> d_inner<span class="token punctuation">,</span> d_outer<span class="token punctuation">,</span> t <span class="token operator">=</span> nearest_pipe<span class="token punctuation">(</span>Di<span class="token operator">=</span>nominal_dia<span class="token punctuation">,</span> schedule<span class="token operator">=</span><span class="token string">&quot;40&quot;</span><span class="token punctuation">)</span>
    inner_dia_list_m<span class="token punctuation">.</span>append<span class="token punctuation">(</span>d_inner<span class="token punctuation">)</span>
length_list_m <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span>
roughness <span class="token operator">=</span> <span class="token number">2e-5</span>
</code></pre></div><p>We can assign the causality to the branches.
</p><p style="text-align:center;"><img src="/TMR4222_2023S/assets/img/pipe_network_with_causality.e74d1025.png" width="500"></p><p></p> <h2 id="equation-writing"><a href="#equation-writing" class="header-anchor">#</a> Equation Writing</h2> <p>Then, we can start writing the equations in the following form.</p> <p>$$
\begin{aligned}
p_{n1} = f_1(p_{n1}, p_{n2})\
p_{n2} = f_2(p_{n1}, p_{n2})
\end{aligned}
$$</p> <p>$$
\begin{aligned}
p_{n1} &amp; = p_{n2} + \Delta p (Q_3)\
&amp; Q_3 = Q_1 + Q_2\
&amp; Q_1 = Q_1\left(p_{b1} - p_{n1}\right)\
&amp; Q_2 = Q_2\left(p_{b2} - p_{n1}\right)  \<br>
p_{n2} &amp; = p_{b3} - \Delta p (Q_4)\
&amp; Q_4 = Q_6 - Q_3 - Q_5\
&amp; Q_6 = Q_{fb1}\
&amp; Q_5 = Q_5\left(p_{b4} - p_{n2}\right)
\end{aligned}
$$</p> <p>First, we will make a function that calculates pressure drop with a given flow.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">get_pressure_drop_pa</span><span class="token punctuation">(</span>
    flow_kg_per_s<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">,</span>
    branch_id<span class="token punctuation">:</span> <span class="token builtin">int</span>
<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">float</span><span class="token punctuation">:</span>    
    <span class="token triple-quoted-string string">&quot;&quot;&quot;Calculates pressure drop given the flow&quot;&quot;&quot;</span>
    <span class="token keyword">return</span> friction<span class="token punctuation">.</span>one_phase_dP<span class="token punctuation">(</span>
        m<span class="token operator">=</span>flow_kg_per_s<span class="token punctuation">,</span>
        rho<span class="token operator">=</span>water<span class="token punctuation">.</span>density<span class="token punctuation">,</span>
        roughness<span class="token operator">=</span>roughness<span class="token punctuation">,</span>
        mu<span class="token operator">=</span>water<span class="token punctuation">.</span>dynamic_viscosity<span class="token punctuation">,</span>
        D<span class="token operator">=</span>inner_dia_list_m<span class="token punctuation">[</span>branch_id <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        L<span class="token operator">=</span>length_list_m<span class="token punctuation">[</span>branch_id <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token punctuation">)</span>
</code></pre></div><h2 id="initial-values"><a href="#initial-values" class="header-anchor">#</a> Initial values</h2> <p>We need the initial values to solve the equations. We will assume the same flow for branches 1, 2, 4, 5.</p> <div class="language-python extra-class"><pre class="language-python"><code>mass_flow_init <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
mass_flow_init<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> mass_flow_fb1_kg_per_s
mass_flow_init<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> mass_flow_init<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">0.25</span>
mass_flow_init<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> mass_flow_init<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">0.25</span>
mass_flow_init<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> mass_flow_init<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">0.5</span>
mass_flow_init<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> mass_flow_init<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">0.25</span>
mass_flow_init<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> mass_flow_init<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">0.25</span>

p_init <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
p_init<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> p_b3 <span class="token operator">-</span> get_pressure_drop_pa<span class="token punctuation">(</span>flow_kg_per_s<span class="token operator">=</span>mass_flow_init<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> branch_id<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
p_init<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> p_init<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> get_pressure_drop_pa<span class="token punctuation">(</span>flow_kg_per_s<span class="token operator">=</span>mass_flow_init<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> branch_id<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Initial_flows for pipes [kg/s]:&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> index<span class="token punctuation">,</span> q_each <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>mass_flow_init<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;\t</span><span class="token interpolation"><span class="token punctuation">{</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token punctuation">{</span>q_each<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Initial pressure for nodes [Pa]:&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> index<span class="token punctuation">,</span> p_each <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>p_init<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;\t</span><span class="token interpolation"><span class="token punctuation">{</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token punctuation">{</span>p_each<span class="token punctuation">:</span><span class="token format-spec">.0f</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
</code></pre></div><div class="language- extra-class"><pre><code>Initial_flows for pipes [kg/s]:
	1 - 374.33
	2 - 374.33
	3 - 748.65
	4 - 374.33
	5 - 374.33
	6 - 1497.31
Initial pressure for nodes [Pa]:
	1 - 176914
	2 - 175648
</code></pre></div><p>We will define the flow function for a pipe section as well. It has to be solved by a numerical solver to get the exact solution.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">get_flow_kg_per_s</span><span class="token punctuation">(</span>
    pressure_drop_pa<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">,</span>
    branch_id<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">float</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;Calculates flow given the pressure drop for the pipe&quot;&quot;&quot;</span>
    <span class="token keyword">def</span> <span class="token function">function_to_solve</span><span class="token punctuation">(</span>flow_guess<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> pressure_drop_pa <span class="token operator">-</span> get_pressure_drop_pa<span class="token punctuation">(</span>
            flow_kg_per_s<span class="token operator">=</span>flow_guess<span class="token punctuation">,</span>
            branch_id<span class="token operator">=</span>branch_id
        <span class="token punctuation">)</span>
    sol <span class="token operator">=</span> root_scalar<span class="token punctuation">(</span>
        f<span class="token operator">=</span>function_to_solve<span class="token punctuation">,</span> 
        x0<span class="token operator">=</span>mass_flow_init<span class="token punctuation">[</span>branch_id <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
        x1<span class="token operator">=</span>mass_flow_init<span class="token punctuation">[</span>branch_id <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">0.9</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">return</span> sol<span class="token punctuation">.</span>root
</code></pre></div><p>Then we can define the functions to get the pressure at the node from the guess values for them as given by the system equations.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">get_mass_flow3</span><span class="token punctuation">(</span>p_n1_init<span class="token punctuation">,</span> p_n2_init<span class="token punctuation">)</span><span class="token punctuation">:</span>
    mass_flow1 <span class="token operator">=</span> get_flow_kg_per_s<span class="token punctuation">(</span>pressure_drop_pa<span class="token operator">=</span>p_b1 <span class="token operator">-</span> p_n1_init<span class="token punctuation">,</span> branch_id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
    mass_flow2 <span class="token operator">=</span> get_flow_kg_per_s<span class="token punctuation">(</span>pressure_drop_pa<span class="token operator">=</span>p_b2 <span class="token operator">-</span> p_n1_init<span class="token punctuation">,</span> branch_id<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> mass_flow1 <span class="token operator">+</span> mass_flow2

<span class="token keyword">def</span> <span class="token function">get_p_n1</span><span class="token punctuation">(</span>p_n1_init<span class="token punctuation">,</span> p_n2_init<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> p_n2_init <span class="token operator">+</span> get_pressure_drop_pa<span class="token punctuation">(</span>
        flow_kg_per_s<span class="token operator">=</span>get_mass_flow3<span class="token punctuation">(</span>p_n1_init<span class="token punctuation">,</span> p_n2_init<span class="token punctuation">)</span><span class="token punctuation">,</span>
        branch_id<span class="token operator">=</span><span class="token number">3</span>
    <span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">get_p_n2</span><span class="token punctuation">(</span>p_n1_init<span class="token punctuation">,</span> p_n2_init<span class="token punctuation">)</span><span class="token punctuation">:</span>
    pressure_drop <span class="token operator">=</span> p_b4 <span class="token operator">-</span> p_n2_init
    mass_flow5 <span class="token operator">=</span> get_flow_kg_per_s<span class="token punctuation">(</span>pressure_drop_pa<span class="token operator">=</span>pressure_drop<span class="token punctuation">,</span> branch_id<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
    mass_flow4 <span class="token operator">=</span> mass_flow_fb1_kg_per_s <span class="token operator">-</span> get_mass_flow3<span class="token punctuation">(</span>p_n1_init<span class="token punctuation">,</span> p_n2_init<span class="token punctuation">)</span> <span class="token operator">-</span> mass_flow5
    <span class="token keyword">return</span> p_b3 <span class="token operator">-</span> get_pressure_drop_pa<span class="token punctuation">(</span>
        flow_kg_per_s<span class="token operator">=</span>mass_flow4<span class="token punctuation">,</span>
        branch_id<span class="token operator">=</span><span class="token number">4</span>
    <span class="token punctuation">)</span>
</code></pre></div><p>Then, the equation to solve becomes:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">system_equation_to_solve</span><span class="token punctuation">(</span>p_array<span class="token punctuation">:</span> np<span class="token punctuation">.</span>ndarray<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> np<span class="token punctuation">.</span>ndarray<span class="token punctuation">:</span>
    p_estimate_array <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>
        get_p_n1<span class="token punctuation">(</span>p_array<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> p_array<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        get_p_n2<span class="token punctuation">(</span>p_array<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> p_array<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> p_array <span class="token operator">-</span> p_estimate_array

solution <span class="token operator">=</span> root<span class="token punctuation">(</span>system_equation_to_solve<span class="token punctuation">,</span> x0<span class="token operator">=</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>p_init<span class="token punctuation">)</span><span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token string">'hybr'</span><span class="token punctuation">)</span>
p_sol <span class="token operator">=</span> solution<span class="token punctuation">.</span>x

<span class="token comment"># Calculate all the flows again</span>
q_sol <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
q_sol<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> get_flow_kg_per_s<span class="token punctuation">(</span>pressure_drop_pa<span class="token operator">=</span>p_b1 <span class="token operator">-</span> p_sol<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> branch_id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
q_sol<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> get_flow_kg_per_s<span class="token punctuation">(</span>pressure_drop_pa<span class="token operator">=</span>p_b2 <span class="token operator">-</span> p_sol<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> branch_id<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
q_sol<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> q_sol<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> q_sol<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
q_sol<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> mass_flow_fb1_kg_per_s
q_sol<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> get_flow_kg_per_s<span class="token punctuation">(</span>pressure_drop_pa<span class="token operator">=</span>p_b4 <span class="token operator">-</span> p_sol<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> branch_id<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
q_sol<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> q_sol<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">-</span> q_sol<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">-</span> q_sol<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span>
q_sol <span class="token operator">/=</span> water<span class="token punctuation">.</span>density

<span class="token comment"># Calculate the pressure at FB1 also</span>
p_fb1 <span class="token operator">=</span> p_sol<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> get_pressure_drop_pa<span class="token punctuation">(</span>flow_kg_per_s<span class="token operator">=</span>mass_flow_fb1_kg_per_s<span class="token punctuation">,</span> branch_id<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Pressure at nodes [Pa]:&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> index<span class="token punctuation">,</span> p_each <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>p_sol<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;\t</span><span class="token interpolation"><span class="token punctuation">{</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token punctuation">{</span>p_each<span class="token punctuation">:</span><span class="token format-spec">.0f</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Flow in branches [m3/s]:&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> index<span class="token punctuation">,</span> q_each <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>q_sol<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;\t</span><span class="token interpolation"><span class="token punctuation">{</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token punctuation">{</span>q_each<span class="token punctuation">:</span><span class="token format-spec">.3f</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Back pressure at the flow boundary is </span><span class="token interpolation"><span class="token punctuation">{</span>p_fb1<span class="token punctuation">:</span><span class="token format-spec">.3f</span><span class="token punctuation">}</span></span><span class="token string"> Pa.&quot;</span></span><span class="token punctuation">)</span>
</code></pre></div><div class="language- extra-class"><pre><code>Pressure at nodes [Pa]:
	1 - 174129
	2 - 173626
Flow in branches [m3/s]:
	1 - 0.243
	2 - 0.216
	3 - 0.459
	4 - 0.520
	5 - 0.520
	6 - 1.500
Back pressure at the flow boundary is 171526.170 Pa.
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/TMR4222_2023S/pipe-friction/" class="prev">
        Pipe Friction
      </a></span> <span class="next"><a href="/TMR4222_2023S/pump-performance/">
        Pump Performance
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/TMR4222_2023S/assets/js/app.4abb8553.js" defer></script><script src="/TMR4222_2023S/assets/js/2.2891b1df.js" defer></script><script src="/TMR4222_2023S/assets/js/10.2f61165d.js" defer></script>
  </body>
</html>
